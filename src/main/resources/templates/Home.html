<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="icon" href="/static/images/icon.svg"/>

    <title>Meu Remédio</title>

    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"  integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="/style/homeStyle.css">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.min.css">

    <!-- Font Awesome JS -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js" integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ" crossorigin="anonymous"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js" integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY" crossorigin="anonymous"></script>


    <!-- Imports do calendario -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/style/calendario1.css">
    <link rel="stylesheet" href="/style/calendario2.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Style -->
    <link rel="stylesheet" href="css/style.css">




</head>
<body>
<div class="wrapper conta-lg">
    <!-- Menu bolado  -->
    <nav th:replace="~{MenuLateral :: menuLateral}"></nav>

    <!-- Local para digitar o texto na página  -->
    <div id="content">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">


            <div class="container-fluid">

                <button type="button" id="sidebarCollapse" class="btn btn-info">
                    <em class="fas fa-align-left"></em>
                    <span>Menu</span>
                </button>
                <a href="/home" class="navbar-brand text-center col-09">
                    <img alt="Brand" src="/images/icon.svg" class="img-responsive text-center">

                </a>

            </div>
        </nav>


        <div class="jumbotron">


            <selection class="jumbotron text-center">
                <div class="container">
                    <h1 class="jumbotron-heading footer" th:text="#{indexwelcome.text}"></h1>
                    <p class="lead text-muted footer" th:text="#{indextext.text}"></p>

                </div>
            </selection>
        </div>
        <div class="line"></div>

        <!-- DIV 1 -->
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-sm-12 col-md-5 col-lg-5 col-lx-5 text-center">
                    <h2 th:text="#{homenotification.text}"></h2>
                    <p></p>

                    <div class="text-center">
                        <button type="button" class="btn btn-info"  onclick="location.href='/agendamentos'" th:text="#{homedetails.text}"></button>
                    </div>
                </div>

                <!-- DIV 2 -->
                <!--<div class="vl"></div> -->
                <div class="col-12 col-sm-12 col-md-6 col-lg-6 col-lx-6">
                    <h2 class="gastos text-center" th:text="#{homespending.text}"></h2>
                    <img alt="Mulher com filha" src="/images/img1.jpg" style="width:100%">
                    <div class="text-center">
                        <button type="button" class="btn btn-info" th:text="#{homedetails.text}"></button>
                    </div>
                </div>
            </div>
        </div>

        <div class="line">
            <!-- DIV 3-->
            <div class="content container-fluid">
                <div id='calendar'></div>
            </div>
            <script src='/script/calendario1.js'></script>
            <script src='/script/calendario2.js'></script>
            <script src='/script/calendario3.js'></script>



            <!--<div class="line"></div>
            <div class="text-center">
                <h2 th:text="#{homecalendar.text}"></h2>
                <img alt="agenda" src="/images/agenda.jpg" style="width:50%">
                <div class="text-center">
                    <button type="button" class="btn btn-info" th:text="#{homedetails.text}"></button>
                </div> -->


        </div>



        <div class="rodape" id="rodapeHome">
            <div class="informacoes-footer text-center">

                <h5>
                    Meu Remédio - CNPJ: 00.000.000/0000-00 - SAC: (11) 0000-0000
                </h5>
                <h5>
                    <a href="mailto:8balls.integratedproject@gmail.com">8balls.integratedproject@gmail.com</a>
                </h5>
                <h5>
                    R. Pedro Vicente, 625 - Canindé, São Paulo - SP, 01109-010
                </h5>
                <div class="" th:each ="agendamento : ${agendamento}">
                    <tr>
                        <td><p><span th:text="${agendamento.remedio}" class="remedios" hidden="true"></span></td>
                        <td><p><span th:text="${agendamento.dataInicio}" class="dataInicio" hidden="true"></span></td>
                        <td><p><span th:text="${agendamento.horaInicio}" class="horaInicio" hidden="true"></span></td>
                        <td><p><span th:text="${agendamento.dataFinal}" class="dataFinal" hidden="true"></span></td>
                        <td><p><span th:text="${agendamento.periodicidade}" class="periodicidade" hidden="true"></span></td>
                    
                            <div class="" th:each = "intervaloDias : ${intervaloDias}">
                            <td><p><span th:text="${agendamento.id} eq ${intervaloDias.id} ? ${intervaloDias.intervaloDias}:''" class="intervaloDias" hidden="true"> </span> </td>
                            </div>
                    </tr>
                </div>
            </div>
        </div>

        </main>

    </div>


    <div class="overlay"></div>
</div>

<!-- jQuery CDN - Slim version (=without AJAX) -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<!-- Popper.JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<!-- Bootstrap JS -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
<!-- jQuery Custom Scroller CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/malihu-custom-scrollbar-plugin/3.1.5/jquery.mCustomScrollbar.concat.min.js"></script>

<script type="text/javascript">
        $(document).ready(function () {
            $("#sidebar").mCustomScrollbar({
                theme: "minimal"
            });

            $('#dismiss, .overlay').on('click', function () {
                $('#sidebar').removeClass('active');
                $('.overlay').removeClass('active');
            });

            $('#sidebarCollapse').on('click', function () {
                $('#sidebar').addClass('active');
                $('.overlay').addClass('active');
                $('.collapse.in').toggleClass('in');
                $('a[aria-expanded=true]').attr('aria-expanded', 'false');
            });
        });
    </script>

<!-- Calendario -->

<script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            const dataConst = Date.now();
            const hoje = new Date(dataConst);

            var remedios = document.getElementsByClassName('remedios');
            var dataInicio = document.getElementsByClassName('dataInicio');
            var dataFinal = document.getElementsByClassName('dataFinal');
            var intervalo = document.getElementsByClassName('intervaloDias');


            var listaAgendamentos = new Array();

            for (var i = 0; i < remedios.length; i++){

                var dataFinalDate = new Date(dataFinal[i].innerHTML)
                var dataFinalAjustada = new Date();
                dataFinalAjustada.setMonth(dataFinalDate.getMonth())
                dataFinalAjustada.setDate(dataFinalDate.getDate() + 2);
                
            
                if (intervalo[i].innerHTML != "" && intervalo[i].innerHTML != 0){
                    var dataInicioAjustada = new Date(dataInicio[i].innerHTML);
                    var dataInicioIntervalo = new Date();
                    dataInicioIntervalo.setDate(dataInicioAjustada.getDate() + 1)
                    // dataInicioIntervalo.setDate(dataInicioIntervalo.getDate() + 1);
                    while (dataInicioIntervalo <= dataFinalAjustada){
                        var ag= {
                            "groupId": i,
                            "title": remedios[i].innerHTML,
                            "start": dataInicioIntervalo.toLocaleDateString('en-CA'),
                            "end": dataInicioIntervalo.toLocaleDateString('en-CA')
                        }
                        console.log(ag)
                        listaAgendamentos.push(ag);
                        dataInicioIntervalo.setDate(dataInicioIntervalo.getDate() + parseInt(intervalo[i].innerHTML) + 1); 
                    }
                } else {
                    var ag= {
                                "groupId": i,
                                "title": remedios[i].innerHTML,
                                "start": dataInicio[i].innerHTML,
                                "end": dataFinalAjustada.toLocaleDateString('en-CA')
                            }
                    listaAgendamentos.push(ag);
                    }
            }
            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: [ 'interaction', 'dayGrid' ],
                defaultDate: hoje,
                editable: true,
                eventLimit: true, // allow "more" link when too many events
               events: listaAgendamentos
            });

            calendar.render();
        });

    </script>

<script src='/script/calendario4.js'></script>
</body>
</html>
